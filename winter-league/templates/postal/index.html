{% extends 'base.html' %}

{% block header %}
  <h1>{% block title %}Competitions{% endblock %}</h1>
  {% if g.user %}
    <a class="action" href="{{ url_for('competition.comp_create') }}">New Competition</a>
  {% endif %}
{% endblock %}

{% block content %}

  {% for competition in data.competitions %}
  {% set num_of_rounds = competition.info.rounds %}
  <div class="card mt-2">
    <div class="card-header">
      <h2 class="display-5 float-left">{{competition.info.name}} <small>{{competition.info.season}}</small></h2>
      <span class="float-right"><a class="btn btn-info float-right" href="{{url_for('competition.comp_edit', id=competition.info.id)}}">edit</a></span>
    </div>
    <div class="card-body">
        <table class="table table-responsive table-bordered results">
          <thead>
          <tr>
            <th>Name</th>
            {% for round in range(competition.info.rounds) %}
            <th>{{loop.index}}</th>
            {% endfor %}
            <th>Total</th>
          </tr>
          </thead>
          <tbody>
            {% for person in competition.team_results %}
              <tr>
                <td>{{person.name}}</td>

                {% for round in range(num_of_rounds) %}
                  {% if person.scores[round] %}
                  <td class="record" data-round="{{loop.index}}" data-name="{{person.name}}" data-shot-id="{{person.scores[round].score_id if person.scores[round]}}">{{ person.scores[round].actual if person.scores[round] in person.scores else '' }}</td>
                  {% else %}
                  <td class="record" data-comp-id="{{competition.info.id}}" data-round="{{loop.index}}" data-user-id="{{person.user_id}}" data-name="{{person.name}}" data-shot-id="">0</td>
                  {% endif%}
                {% endfor %}
                <td>{{person.scores | sum(attribute='actual')}}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
    </div>
  </div>
  {% else %}
    No data
  {% endfor %}

<!-- The Modal -->
<div class="modal" id="add_score">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Round <span id="round_header_num"></span></h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <form id="score_form" method="post" action="{{url_for('competition.result_save')}}">
      <div class="modal-body">
        <a href="#form_details" data-toggle="collapse" class="float-right">More</a>
        <div id="form_details" class="collapse">
          <label for="score_id">Score ID:</label>
          <input class="form-control" type="text" name="score_id" id="score_id" value=""/>
          <label for="competition_id">Competition ID:</label>
          <input class="form-control" type="text" name="competition_id" id="competition_id" value=""/>
          <label for="user_id">User ID:</label>
          <input class="form-control" type="text" name="user_id" id="user_id" value=""/>
          <label for="round">Round #:</label>
          <input class="form-control" type="text" name="round" id="round" value=""/>
        </div>
        <div class="form-group">
          <label for="shooter_name">Shooter Name:</label>
          <input class="form-control" type="text" name="shooter_name" id="shooter_name" value=""/>
        </div>
        <div class="form-group">
          <label for="estimated">Estmiated:</label>
          <div class="input-group">
            <input class="form-control" type="text" name="estimated" id="estimated" value=""/>
            <div class="input-group-append">
              <span class="input-group-text">/100</span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="actual">Actual:</label>
            <div class="input-group">
            <input class="form-control" type="text" name="actual" id="actual" value=""/>
            <div class="input-group-append">
              <span class="input-group-text">/100</span>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label for="date_shot">Date Shot:</label>
          <input class="form-control" type="date" name="date_shot" id="date_shot" forma value="" required/>
        </div>
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="submit" class="btn btn-success">Add result</button>
        <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
      </div>
      </form>
    </div>
  </div>
</div>

{% endblock %}